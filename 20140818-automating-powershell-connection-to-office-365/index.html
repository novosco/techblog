<!DOCTYPE html>
<html dir='ltr' lang='en' xmlns:fb='http://ogp.me/ns/fb#'>
<head>
<link href="../stylesheets/syntax_highlighting.css?1439193430" media="screen" rel="stylesheet" type="text/css" />
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='text/html;' http-equiv='content-type'>
<title>Automating PowerShell Connection to Office 365
 | Novosco Tech Blog</title>
<meta content='index,follow' name='robots'>
<meta content='initial-scale=1.0 maximum-scale=1.0 user-scalable=no' name='viewport'>
<meta content='width=380, maximum-scale=1.0' name='viewport'>
<link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
<link href='../images/touch-icon-iphone.png' rel='apple-touch-icon'>
<link href='../images/touch-icon-ipad.png' rel='apple-touch-icon' sizes='72x72'>
<link href='../images/touch-icon-iphone-retina.png' rel='apple-touch-icon' sizes='114x114'>
<link href='../images/touch-icon-ipad-retina.png' rel='apple-touch-icon' sizes='144x144'>
<!--[if lt IE 9]> <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script> <![endif]-->
<link href="../stylesheets/all.css?1439193430" media="screen" rel="stylesheet" type="text/css" />
<!-- OG -->
<meta content='Novosco Tech Blog' property='og:title'>
<meta content='website' property='og:type'>
<meta content='../images/novosco-og-icon.png' property='og:image'>
<meta content='http://engineering.novosco.com' property='og:url'>
<meta content='Novosco Tech Blog ' property='og:description'>
<!-- Twitter -->
<meta content='summary' name='twitter:card'>
<meta content='http://engineering.novosco.com' name='twitter:url'>
<meta content='Novosco Tech Blog' name='twitter:title'>
<meta content='Novosco Tech Blog ' name='twitter:description'>
<meta content='../images/novosco-og-icon.png' name='twitter:image'>
<meta content='@novoscoeng' name='twitter:site'>
<meta content='@novosco' name='twitter:creator'>
<meta content='' name='author'>
<!-- Typekit -->
<script src="//use.typekit.net/tjm4emr.js" type="text/javascript"></script>
<script>
  try{Typekit.load();}catch(e){};
  
  window.onload = function() {
    var menu = document.getElementById('menu-button');
    var menu_items = document.getElementById('menu-items');
  
    function toggleMenu(){
      if (menu_items.style.display == "block") {
        menu_items.style.display = 'none';
      } else {
        menu_items.style.display = 'block';
      }
    };
  
    menu.addEventListener('click', function() {
      toggleMenu()
    }, false);
  };
</script>

</head>
<body class='20140818-automating-powershell-connection-to-office-365 20140818-automating-powershell-connection-to-office-365_index'>
<header>
<div class='layout-wrapper'>
<div class='layout-inner'>
<a href="/"><span class='logo'>Novosco Tech Blog</span></a>
<div class='header-nav'>
<nav>
<a href='#' id='menu-button'>
MENU
<img src='/images/menu-triangle.png' width='11px'>
</a>
<ul id='menu-items'>
<li>
<a href="http://www.novosco.com/">Home</a>
</li>
<li>
<a class="active" href="http://cio.novosco.com/">CIO Blog</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
</header>

<div class='container'>
<div id='post-main'>
<article class='post-header'>
<h1 class='article-header'>
<a href="/20140818-automating-powershell-connection-to-office-365/">Automating PowerShell Connection to Office 365</a>
</h1>
<div class='post-meta'>
<div class='post-avatar'>
<img src="../images/avatars/alan-mcburney.jpg?1439193430" />
</div>
<div class='post-meta-text'>
<span>By <a href="/alan-mcburney">Alan McBurney</a> on</span>
<time>18 August 2014</time>
</div>
</div>

<div class='body'>
<p>Connecting to Office 365 manually can be a bit of a chore especially if you need to do it on a regular basis, so why not automate the task.</p>

<p>Be sure the following components have been installed on your system before attempting this.</p>

<ul>
<li>Azure Active Directory Module for Windows PowerShell</li>
<li>Microsoft Online Services Sign-In Assistant</li>
</ul>

<p>In order to automate the task, credentials are exported to an XML file.</p>

<p><strong>_Get-Credential _</strong> <a href="mailto:user@domain.com"><em>user@domain.com</em></a><strong>_ | Export-Clixml $env:USERPROFILE\Documents\MyO365Creds.xml_</strong></p>

<p>The cool thing about exporting the credentials used to connect to 365 using the Export-Clixml command is that the credentials are automatically encrypted within the file using <a href="http://msdn.microsoft.com/en-us/library/ms995355.aspx">DPAPI</a> and can only by decrypted by the person who originally saved it.</p>

<p><a href="https://everythingsysadmin.files.wordpress.com/2014/08/image.png"> <img title="image" alt="image" src="https://everythingsysadmin.files.wordpress.com/2014/08/image_thumb.png?w=244&h=128" /> </a> </p>

<p>The final piece of the automation process is adding this into your PowerShell profile<br>
First test to see if a profile exists</p>

<p><strong><em>Test-Path $Profile</em></strong></p>

<p>Running the above command will return either a True or False value.<br>
True being that the profile exists, false that it doesn’t</p>

<p>If the return value is false then in order to create the profile run the code below</p>

<p><strong><em>New-Item -Type File -Path $Profile</em></strong></p>

<p><a href="https://everythingsysadmin.files.wordpress.com/2014/08/image1.png"> <img title="image" alt="image" src="https://everythingsysadmin.files.wordpress.com/2014/08/image_thumb1.png?w=244&h=114" /> </a></p>

<p>Once the profile exists, to open the Profile type</p>

<p><strong><em>N</em></strong><strong><em>otepad $Profile</em></strong></p>

<p>Finally enter the following into your PowerShell profile. This will run every time you launch PowerShell</p>

<p><strong>Import-Module MSOnline<br>
$Cred = Import-Clixml $env:USERPROFILE\Documents\MyO365Creds.xml<br>
Connect-MsolService -Credential $Cred</strong></p>

<p>If you work with multiple office 365 accounts each one of these credentials can be represented by a variable within your PowerShell profile.</p>

<p><strong><em>$Cust1Cred = Import-Clixml $env:USERPROFILE\Documents\Cust1O365Creds.xml<br>
$Cust2Cred = Import-Clixml $env:USERPROFILE\Documents\Cust2O365Creds.xml<br>
$Cust3Cred = Import-Clixml $env:USERPROFILE\Documents\Cust3O365Creds.xml</em></strong></p>

<p>Typically I will omit the final line from the Profile to connect to the service.<br>
Then its really simple to connect to a customers tenancy using</p>

<p><strong><em>Connect-MSOLService –Credential $Cust1Cred</em></strong></p>

<p><a href="http://feeds.wordpress.com/1.0/gocomments/everythingsysadmin.wordpress.com/673/"> <img src="http://feeds.wordpress.com/1.0/comments/everythingsysadmin.wordpress.com/673/" /> </a> <img src="http://pixel.wp.com/b.gif?host=everythingsysadmin.wordpress.com&blog=8998607&post=673&subd=everythingsysadmin&ref=&feed=1" /></p>

<div class='tags'>
<ol>
<li><a class="tag" href="/office-365/">Office 365</a></li>
</ol>
</div>
<section class='post-footer'>
<h1 class='small-h1 post-author-header'>
<div class='post-author clearfix'>
<div class='author-avatar'>
<img src="../images/avatars/alan-mcburney.jpg?1439193430" />
</div>
<div class='post-author-details'>
<h1><a href="/alan-mcburney">Alan McBurney</a></h1>
<span class='bio'>Solutions Architect @Novosco. Passionate about technology, delivering Microsoft centric solutions with emphasis on Lync, Exchange, PowerShell and Infrastructure.</span>
<span class='author-posts-link'>
<a href="/alan-mcburney">View Alan's other posts</a>
</span>
</div>
</div>
</h1>
</section>
<div class='post-nav'>
<div class='previous-post'>
<a href="/20140818-how-vsans-are-like-kit-cars-in-light-of-recent-vsan-hcl-update/">← Previous</a>
</div>
<div class='next-post'>
<a href="/20140827-script-fixing-orphaned-adminsdholder-accounts/">Next →</a>
</div>
</div>
</div>
</article>
</div>
</div>
<footer>
<section class='newsletter'>
<div class='layout-wrapper' id='mc-signup'>
<div class='layout-inner'>
<form action='http://novosco.us7.list-manage1.com/subscribe/post?u=9bff1bb397f0ed0fda92caa1a&amp;id=b15b8e54dd' class='validate' id='mc-subscribe-form' method='post' name='mc-embedded-subscribe-form' novalidate='' target='_blank'>
<div class='form-inputs'>
<label for='mc-email'>
<div class='newsletter-title'>
Subscribe to our mailing list
</div>
<input id='mc-email' name='EMAIL' placeholder='Enter your email address…' required='' type='email' value=''>
</label>
</div>
<div class='form-action newsletter-button'>
<input class='button' name='subscribe' type='submit' value='Subscribe'>
</div>
</form>
</div>
</div>
</section>
<section class='footer-info clearfix'>
<div class='layout-wrapper'>
<div class='layout-inner'>
<span class='about-novosco'>
<strong>Novosco</strong>
is a leading provider of Cloud Technologies, Managed Service and Consulting.
</span>
<span class='copyright'>
© 2007-2015 Novosco Ltd
</span>
</div>
</div>
</section>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-44792610-1', 'novosco.com');
  ga('send', 'pageview');
</script>

</body>
</html>
