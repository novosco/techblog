<!DOCTYPE html>
<html dir='ltr' lang='en' xmlns:fb='http://ogp.me/ns/fb#'>
<head>
<link href="../stylesheets/syntax_highlighting.css?1439193430" media="screen" rel="stylesheet" type="text/css" />
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='text/html;' http-equiv='content-type'>
<title>Ireland VMUG January 2014 - Trench Talk
 | Novosco Tech Blog</title>
<meta content='index,follow' name='robots'>
<meta content='initial-scale=1.0 maximum-scale=1.0 user-scalable=no' name='viewport'>
<meta content='width=380, maximum-scale=1.0' name='viewport'>
<link href='/favicon.ico' rel='shortcut icon' type='image/x-icon'>
<link href='../images/touch-icon-iphone.png' rel='apple-touch-icon'>
<link href='../images/touch-icon-ipad.png' rel='apple-touch-icon' sizes='72x72'>
<link href='../images/touch-icon-iphone-retina.png' rel='apple-touch-icon' sizes='114x114'>
<link href='../images/touch-icon-ipad-retina.png' rel='apple-touch-icon' sizes='144x144'>
<!--[if lt IE 9]> <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script> <![endif]-->
<link href="../stylesheets/all.css?1439193430" media="screen" rel="stylesheet" type="text/css" />
<!-- OG -->
<meta content='Novosco Tech Blog' property='og:title'>
<meta content='website' property='og:type'>
<meta content='../images/novosco-og-icon.png' property='og:image'>
<meta content='http://engineering.novosco.com' property='og:url'>
<meta content='Novosco Tech Blog ' property='og:description'>
<!-- Twitter -->
<meta content='summary' name='twitter:card'>
<meta content='http://engineering.novosco.com' name='twitter:url'>
<meta content='Novosco Tech Blog' name='twitter:title'>
<meta content='Novosco Tech Blog ' name='twitter:description'>
<meta content='../images/novosco-og-icon.png' name='twitter:image'>
<meta content='@novoscoeng' name='twitter:site'>
<meta content='@novosco' name='twitter:creator'>
<meta content='' name='author'>
<!-- Typekit -->
<script src="//use.typekit.net/tjm4emr.js" type="text/javascript"></script>
<script>
  try{Typekit.load();}catch(e){};
  
  window.onload = function() {
    var menu = document.getElementById('menu-button');
    var menu_items = document.getElementById('menu-items');
  
    function toggleMenu(){
      if (menu_items.style.display == "block") {
        menu_items.style.display = 'none';
      } else {
        menu_items.style.display = 'block';
      }
    };
  
    menu.addEventListener('click', function() {
      toggleMenu()
    }, false);
  };
</script>

</head>
<body class='20140129-ireland-vmug-january-2014-trench-talk 20140129-ireland-vmug-january-2014-trench-talk_index'>
<header>
<div class='layout-wrapper'>
<div class='layout-inner'>
<a href="/"><span class='logo'>Novosco Tech Blog</span></a>
<div class='header-nav'>
<nav>
<a href='#' id='menu-button'>
MENU
<img src='/images/menu-triangle.png' width='11px'>
</a>
<ul id='menu-items'>
<li>
<a href="http://www.novosco.com/">Home</a>
</li>
<li>
<a class="active" href="http://cio.novosco.com/">CIO Blog</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
</header>

<div class='container'>
<div id='post-main'>
<article class='post-header'>
<h1 class='article-header'>
<a href="/20140129-ireland-vmug-january-2014-trench-talk/">Ireland VMUG January 2014 - Trench Talk</a>
</h1>
<div class='post-meta'>
<div class='post-avatar'>
<img src="../images/avatars/james-montgomery.jpg?1439193430" />
</div>
<div class='post-meta-text'>
<span>By <a href="/james-montgomery">James Montgomery</a> on</span>
<time>29 January 2014</time>
</div>
</div>

<div class='body'>
<p>Organised by VMUG and Novosco - the event was held at the MAC in Belfast with good attendance. I was asked to present at the event.</p>

<p></p>

<h1>My VMUG event presentation.</h1>

<h2>Setting the scene:</h2>

<p>When approached by John Lennon to present for this event - the subject matter was for me to decide, it only needed to be relevant to a VMware user group. Often when I present the scope of the subject is prescriptively narrow. For example there is only so much variation on a presentation for backup or DR.</p>

<p>I thought on current and recent projects to focus on a subject that should resonate with the expected audience.</p>

<p>At the time of producing my presentation I was engaged with a customer on migrating them to a new vSphere environment. One element of this project involved the new EMC VNX2 (block), quite a contrast from the in-place EMC Celerra. I decided to focus on a component of this project - new storage and a new storage architecture.</p>

<p>This narrowed the subject enough to allowed to me to &ldquo;deep dive&rdquo; within the relatively small amount of time for a presentation.</p>

<p>The presentation was titled &ldquo;Trench Talk: So you’ve got new storage. Now what?&rdquo;.</p>

<p>I begin by discussing the familiar life sales cycle that eventually leads to system installation and configuration.</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/SalesCycle.png?1439193430" /></p>

<p>Beginning with pre-sales I summarise how customer storage requirements are often articulated in 8 categories:</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/StorageRequirements.png?1439193430" /></p>

<p>I point out that storage performance is often not explicitly called out, and often it is assumed that a new system with increased usable storage (compared to the old) will bring with it increased performance.</p>

<p>This is not an unreasonable assumption if you are comparing systems of a certain size on a 3-5 year refresh cycle. Often there have been significant gains in architecture and hardware capability for this to be true by default in many cases.</p>

<p>It is however an assumption. My presentation wanted to shed light on this and discuss way of determining the capability of a storage platform in a VMware environment through testing.</p>

<h2>Why test?</h2>

<p>I discuss four reasons for testing new storage:</p>

<ol>
<li>Testing new toys storage platforms can be fun and interesting.</li>
<li>Establish certainty of platform behaviour.</li>
<li>Prevent future surprises.</li>
<li>Set expectations.</li>
</ol>

<p>We proceed to discuss how I/O testing can help in these four areas.</p>

<h2>I/O Testing Methodology</h2>

<p>Moving onto what is the core subject material I break I/O testing into three areas:</p>

<ul>
<li>Understand your storage architecture and storage design. </li>
<li>Derive a list of tests to cover all interested scenarios.</li>
<li>Set expectations on the test results. Compare with actual results. Explain the differences if you can!</li>
</ul>

<h3>Understand your storage architecture and storage design</h3>

<p>I&rsquo;m always reading blog posts. In particularly I love it when people discuss architectural differences and design decisions. </p>

<p>I was reading this <a href="http://itzikr.wordpress.com/2013/12/30/a-tale-of-two-architectures-engineering-for-the-99-999-versus-the-0-001/">post</a> by Itzik Reich who works for XtremeIO within EMC. If you abstract the blog content he is basically discusses that understanding your storage architecture and producing a storage design for performance assurance and availability varies across storage products. Not surprising XtremeIO is the winner of that blog post (bet you didn&rsquo;t see that coming?).</p>

<p>You can simplify the point further. </p>

<p>Are you designing for the sunny days (assume everything is working all the time, don&rsquo;t worry about the small chance of failure or its impact) or the rainy days(some element or multiple elements will break, you don&rsquo;t want any impact to performance)?</p>

<p>The answer to this doesn&rsquo;t change anything in the actual testing but it will cause different interpretations of results.</p>

<h3>Derive a list of tests to cover all interested scenarios.</h3>

<p>In order to keep my presentation measured with minutes and not calendars I illustrate with this simple configuration:</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/simple_storage_example_1.png?1439193430" /></p>

<p>In the above example a typical mid-range array will be pseudo active-active. The LUN is technically accessible by way of 4 paths. Two will be &ldquo;optimised&rdquo; and will be preferred. The storage processor owning the LUN will receive all I/O in a round-robin fashion.</p>

<p>Even with this simple configuration and using the default VMware PSP - how many IOPs before the PSP alternates the path used?</p>

<p>If you need to look this up here is a <a href="http://cormachogan.com/2013/07/08/automating-the-iops-setting-in-the-round-robin-psp/">link</a> that will help.</p>

<p>In the case that you are designing exclusively for the sunny day - you won&rsquo;t be too interested in understanding the what happens in the case of failure. </p>

<p>If you were interested in designing for the rainy day you would need to understand the path utilisation in various failure scenarios. You would have a good start by reading this <a href="http://blogs.vmware.com/vsphere/2012/07/path-failure-and-related-satppsp-behaviour.html">post</a> on PSP/SATP behaviour.</p>

<p>Whenever we discuss multiple hosts and LUNs bound to multiple SPs it becomes clear that designing for the rainy day can be hard work:</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/simple_storage_example_2.png?1439193430" /></p>

<p>It is therefore necessary to construct a methodology for testing.</p>

<h3>Determine the best and worst case performance.</h3>

<p>Below is a mind map of a testing methodology I use for determining the maximums and minimums of a given storage target:</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/testing_methodology_1.png?1439193430" /></p>

<p>Repeat the same benchmarks with your production configuration. Expect the performance to be less in some respects that the very maximum capability produces. The difference will be attribute to the cost of availability - for example:</p>

<ul>
<li>Less disks due to hot sparing means fewer spindles for IOPs.</li>
<li>CPU overhead due to parity. You could run on RAID 0 - but there would be a lot of rainy days and many tears.</li>
<li>You may choose N+1 performance availability at the SP (or other) level. Meaning while you not only want to technically survive a failure, you also want no performance degradation.</li>
</ul>

<h3>Testing decisions</h3>

<p>By now its accepted that robust testing is both time consuming and requires deep knowledge of the elements involved.</p>

<p>I introduce the concept that even with a methodology the execution of testing can have many permutations.</p>

<ul>
<li>Synthetic benchmarking (e.g.Iometer)</li>
<li>Workload benchmarking (e.g. Jetstress for MS Exchange disk testing)</li>
<li>Your I/O profile (a complete reproduction of your I/O on the new system)</li>
</ul>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/test_permutations_1.png?1439193430" /></p>

<p>You need to decided what type of testing you are going to perform. There is value in all types but excluding academic interest - the amount of time you can dedicate to the task will likely dictate your choice.</p>

<h2>Testing</h2>

<p>After laying the groundwork I discuss how the above could be achieved using a VMware fling &ldquo;VMware I/O Analyzer&rdquo;. You can find more about VMware flings at their website <a title="https://labs.vmware.com/flings" href="https://labs.vmware.com/flings">https://labs.vmware.com/flings</a>.</p>

<p>Lifting some text directly from the fling description articulates why this is a good tool for the job:</p>

<blockquote>
<ul>
<li>Integrated framework for storage performance testing</li>
<li>Readily deployable virtual appliance</li>
<li>Easy configuration and launch of storage I/O tests on one or more hosts</li>
<li>Integrated performance results at both guest and host levels</li>
<li>Storage I/O trace replay as an additional workload generator</li>
<li>Ability to upload storage I/O traces for automatic extraction of vital metrics</li>
<li>Graphical visualization of workload metrics and performance results</li>
</ul>
</blockquote>

<p>Here are some screenshots using the tool. We used it primarily for synthetic benchmarking. </p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/test_results_1.png?1439193430" /></p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/test_results_2.png?1439193430" /></p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/test_results_3.png?1439193430" /></p>

<h2>Benchmark results</h2>

<p>I have endless excel spreadsheets and graphs from the testing we performed. I picked this one for illustration.</p>

<p><img src="../images/jamesmontgomery/vmug_ire_2014/benchmark_results_1.png?1439193430" /></p>

<p>Even without the exact numbers graphed you can make some deductions on the effect of workload size on performance - and the effect of SP failure (compare &ldquo;2 hosts / 2 SP&rdquo; vs &ldquo;2 hosts / 1 SP&rdquo;).</p>

<h1>Using the I/O results in practical scenarios</h1>

<p>Understanding your platform capabilities allows you to determine if you are approaching a maximum on your storage platform. Using the information from testing you may construct alarms or reports in your monitoring system of choice. Forewarned is forearmed don&rsquo;t they say?</p>

<h2>Setting expectations</h2>

<p>I use backup as a practical use of this type of testing.</p>

<p>Guest level backups can have specific I/O requirements. I quote from an Avamar KB on understanding the performance of a file system backup:</p>

<blockquote>
<p>Avamar agent file system backup for example will perform two I/O operations (one for the file attributes, another for the security attributes) for each file that needs to be scanned.</p>
</blockquote>

<p>EMC provide maximums for a number of plugins in order to set expectations - around 1 million files per hour for the file system plugin. Not everyone will achieve this - EMC are providing a maximum expectation here where the hardware is not bounding the software. Armed with this information you can determine if your Avamar job performance is bound by the backing storage or other factor. </p>

<p>VM level disk based backup can have fairly predictable I/O patterns:</p>

<p>For example a product producing incremental against a full backup would exhibit random read from the source disk system (CBT map) with sequential write on the target. Based on the configuration of the backup product there will eventually be an incremental roll up which would exhibit sequential read (of the incremental files) and random write (incremental roll up into an existing monolithic backup file) often on the same storage.</p>

<p>I/O testing can therefore help right size a backup solution or right size your expectations.</p>

<h1>Closing comments</h1>

<p>It was an interesting experience presenting a topic that is relatively theoretical in nature to peers in the local VMware community. The VMUG provides an opportunity to network with peers and foster discussion outside of your normal working environment.</p>

<p>If you can attend future VMUG meetings then I would recommend you do so.</p>

<h1>About VMUG</h1>

<p>You can find out more about VMUG here:
<a title="http://www.vmug.com/p/cm/ld/fid=4" href="http://www.vmug.com/p/cm/ld/fid=4">http://www.vmug.com/p/cm/ld/fid=4</a></p>

<p>You can find upcoming VMUG events here:
<a title="http://www.vmug.com/p/cm/ld/fid=28" href="http://www.vmug.com/p/cm/ld/fid=28">http://www.vmug.com/p/cm/ld/fid=28</a></p>

<div class='tags'>
<ol>
<li><a class="tag" href="/vmware/">VMware</a></li>
<li><a class="tag" href="/vmug/">VMUG</a></li>
<li><a class="tag" href="/storage/">Storage</a></li>
</ol>
</div>
<section class='post-footer'>
<h1 class='small-h1 post-author-header'>
<div class='post-author clearfix'>
<div class='author-avatar'>
<img src="../images/avatars/james-montgomery.jpg?1439193430" />
</div>
<div class='post-author-details'>
<h1><a href="/james-montgomery">James Montgomery</a></h1>
<span class='bio'>A passionate and sometimes obsessive problem solver who rants about predictable failures. Hates exceptions. Often found near coffee.</span>
<span class='author-posts-link'>
<a href="/james-montgomery">View James's other posts</a>
</span>
</div>
</div>
</h1>
</section>
<div class='post-nav'>
<div class='previous-post'>
<a href="/20140124-configuring-vsphere-app-ha-10/">← Previous</a>
</div>
<div class='next-post'>
<a href="/20140414-whats-up-at-synergy-2014/">Next →</a>
</div>
</div>
</div>
</article>
</div>
</div>
<footer>
<section class='newsletter'>
<div class='layout-wrapper' id='mc-signup'>
<div class='layout-inner'>
<form action='http://novosco.us7.list-manage1.com/subscribe/post?u=9bff1bb397f0ed0fda92caa1a&amp;id=b15b8e54dd' class='validate' id='mc-subscribe-form' method='post' name='mc-embedded-subscribe-form' novalidate='' target='_blank'>
<div class='form-inputs'>
<label for='mc-email'>
<div class='newsletter-title'>
Subscribe to our mailing list
</div>
<input id='mc-email' name='EMAIL' placeholder='Enter your email address…' required='' type='email' value=''>
</label>
</div>
<div class='form-action newsletter-button'>
<input class='button' name='subscribe' type='submit' value='Subscribe'>
</div>
</form>
</div>
</div>
</section>
<section class='footer-info clearfix'>
<div class='layout-wrapper'>
<div class='layout-inner'>
<span class='about-novosco'>
<strong>Novosco</strong>
is a leading provider of Cloud Technologies, Managed Service and Consulting.
</span>
<span class='copyright'>
© 2007-2015 Novosco Ltd
</span>
</div>
</div>
</section>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-44792610-1', 'novosco.com');
  ga('send', 'pageview');
</script>

</body>
</html>
